<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Personal carbon footprint tracker with achievements, goals, and actionable recommendations to reduce your environmental impact">
    <meta name="keywords" content="carbon footprint, environment, sustainability, climate change, CO2 tracker">
    <meta name="author" content="Carbon Lite">
    <meta name="theme-color" content="#667eea">
    <meta property="og:title" content="Carbon Lite - Track Your Environmental Impact">
    <meta property="og:description" content="Monitor and reduce your carbon footprint with personalized recommendations and goal tracking">
    <meta property="og:type" content="website">
    <meta name="robots" content="index, follow">
    
    <title>Carbon Lite - Track Your Environmental Impact</title>
    
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #4c63d2;
            --secondary: #764ba2;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --background-dark: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            --card-bg: white;
            --card-bg-dark: #1f2937;
            --text: #333;
            --text-dark: #f9fafb;
            --text-muted: #6b7280;
            --text-muted-dark: #9ca3af;
            --border: #e5e7eb;
            --border-dark: #374151;
        }

        [data-theme="dark"] {
            --background: var(--background-dark);
            --card-bg: var(--card-bg-dark);
            --text: var(--text-dark);
            --text-muted: var(--text-muted-dark);
            --border: var(--border-dark);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            min-height: 100vh;
            color: var(--text);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            color: white;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .header-controls {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            gap: 1rem;
        }

        .theme-toggle, .help-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .theme-toggle:hover, .help-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .achievement {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 1rem;
            text-align: center;
            transition: all 0.2s ease;
            cursor: pointer;
            transform: scale(0.95);
        }

        .achievement.unlocked {
            border-color: var(--success);
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            transform: scale(1);
        }

        .achievement:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .achievement.unlocked:hover {
            transform: scale(1.1);
        }

        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            filter: grayscale(100%);
            transition: filter 0.3s ease;
        }

        .achievement.unlocked .achievement-icon {
            filter: none;
        }

        .achievement-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-muted);
        }

        .achievement.unlocked .achievement-title {
            color: var(--success);
        }

        .section {
            margin-bottom: 2rem;
        }

        .section h2 {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .slider-container {
            position: relative;
            margin-bottom: 0.5rem;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .slider-value {
            text-align: center;
            margin-top: 0.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .button {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .button:hover::before {
            left: 100%;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .button-secondary {
            background: var(--text-muted);
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.4);
        }

        .button-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .button-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .result-card {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .result-card .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .result-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text);
            margin-bottom: 0.25rem;
        }

        .result-card .label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .recommendations {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-radius: 15px;
            padding: 1.5rem;
        }

        .recommendation-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 10px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .recommendation-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left-color: var(--success);
        }

        .recommendation-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--success);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .recommendation-content {
            flex: 1;
        }

        .recommendation-title {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.25rem;
        }

        .recommendation-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .recommendation-impact {
            color: var(--success);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .recommendation-difficulty {
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .difficulty-easy {
            background: #ecfdf5;
            color: var(--success);
        }

        .difficulty-medium {
            background: #fef3c7;
            color: var(--warning);
        }

        .difficulty-hard {
            background: #fef2f2;
            color: var(--danger);
        }

        .hidden {
            display: none;
        }

        .navigation {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .goal-setting {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .goal-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text);
            margin-bottom: 1rem;
        }

        .goal-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--primary));
            transition: width 0.3s ease;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 2rem;
        }

        .impact-score {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .score-number {
            font-size: 3rem;
            font-weight: bold;
            color: #92400e;
            margin-bottom: 0.5rem;
        }

        .score-label {
            color: #92400e;
            font-weight: 600;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .history-item {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .history-date {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .history-total {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text);
        }

        .badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transform: scale(0.7) translateY(50px);
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid var(--border);
        }

        .modal-overlay.show .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-close {
            background: var(--border);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 1.2rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
            transform: scale(1.1);
        }

        .modal-content {
            color: var(--text);
            line-height: 1.6;
        }

        .modal-content h3 {
            color: var(--primary);
            margin: 1.5rem 0 0.75rem 0;
            font-size: 1.1rem;
        }

        .modal-content h3:first-child {
            margin-top: 0;
        }

        .modal-content p {
            margin-bottom: 1rem;
        }

        .modal-content ul {
            margin: 0.5rem 0 1rem 1.5rem;
        }

        .modal-content li {
            margin-bottom: 0.5rem;
        }

        .achievement-modal-content {
            text-align: center;
        }

        .achievement-icon-large {
            font-size: 4rem;
            margin-bottom: 1rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }

        .achievement-description {
            font-size: 1.1rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        .achievement-status {
            padding: 1rem;
            border-radius: 15px;
            font-weight: 600;
            margin-top: 1rem;
        }

        .achievement-status.unlocked {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            color: var(--success);
            border: 2px solid var(--success);
        }

        .achievement-status.locked {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            color: var(--text-muted);
            border: 2px solid var(--border);
        }

        .help-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 1.5rem;
            border-radius: 15px;
            margin: 1rem 0;
            border-left: 4px solid var(--primary);
        }

        @media (max-width: 640px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .navigation {
                flex-direction: column;
            }

            .header-controls {
                position: relative;
                justify-content: center;
                margin-top: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <div class="header">
            <div class="header-controls">
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">🌙</button>
                <button class="help-btn" onclick="showHelp()" title="Help & Tutorial">❓</button>
            </div>
            <h1>🌱 Carbon Lite</h1>
            <p>Your personal carbon footprint tracker with goals & achievements</p>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="card">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="current-footprint">0</div>
                    <div class="stat-label">Current Monthly CO₂ (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-saved">0</div>
                    <div class="stat-label">Total CO₂ Saved (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="streak-count">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="achievement-count">0</div>
                    <div class="stat-label">Achievements</div>
                </div>
            </div>

            <!-- Goal Setting -->
            <div class="goal-setting">
                <h3>🎯 Your Carbon Goal</h3>
                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <input type="number" id="carbon-goal" class="goal-input" placeholder="Set monthly CO₂ goal (kg)" style="flex: 1; min-width: 200px;">
                    <button class="button button-warning" onclick="setGoal()">Set Goal</button>
                </div>
                <div id="goal-progress" class="hidden" style="margin-top: 1rem;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="goal-progress-fill"></div>
                    </div>
                    <p id="goal-text" style="text-align: center; margin-top: 0.5rem; font-weight: 600;"></p>
                </div>
            </div>

            <!-- Achievements -->
            <div class="section">
                <h2>🏆 Achievements</h2>
                <div class="achievement-grid" id="achievements">
                    <!-- Achievements will be populated here -->
                </div>
            </div>

            <div class="navigation">
                <button class="button" onclick="showAssessment()">New Assessment</button>
                <button class="button button-secondary" onclick="showHistory()">View History</button>
                <button class="button button-success" onclick="showShare()">Share Progress</button>
            </div>
        </div>

        <!-- Assessment Form -->
        <div id="assessment-form" class="card hidden">
            <div class="section">
                <h2>🚗 Transportation</h2>
                
                <div class="form-group">
                    <label for="car-km">Kilometers driven per week</label>
                    <div class="slider-container">
                        <input type="range" id="car-km" class="slider" min="0" max="1000" value="200">
                        <div class="slider-value"><span id="car-km-value">200</span> km/week</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="flights">Number of flights per year</label>
                    <div class="slider-container">
                        <input type="range" id="flights" class="slider" min="0" max="20" value="2">
                        <div class="slider-value"><span id="flights-value">2</span> flights/year</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="public-transport">Hours of public transport per week</label>
                    <div class="slider-container">
                        <input type="range" id="public-transport" class="slider" min="0" max="50" value="5">
                        <div class="slider-value"><span id="public-transport-value">5</span> hours/week</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>🏠 Home Energy</h2>
                
                <div class="form-group">
                    <label for="electricity">Monthly electricity bill (USD)</label>
                    <div class="slider-container">
                        <input type="range" id="electricity" class="slider" min="0" max="500" value="100">
                        <div class="slider-value">$<span id="electricity-value">100</span>/month</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="heating">Monthly heating/gas bill (USD)</label>
                    <div class="slider-container">
                        <input type="range" id="heating" class="slider" min="0" max="300" value="80">
                        <div class="slider-value">$<span id="heating-value">80</span>/month</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>🍽️ Food & Diet</h2>
                
                <div class="form-group">
                    <label for="meat-meals">Meat meals per week</label>
                    <div class="slider-container">
                        <input type="range" id="meat-meals" class="slider" min="0" max="21" value="10">
                        <div class="slider-value"><span id="meat-meals-value">10</span> meals/week</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="dairy">Dairy servings per day</label>
                    <div class="slider-container">
                        <input type="range" id="dairy" class="slider" min="0" max="10" value="3">
                        <div class="slider-value"><span id="dairy-value">3</span> servings/day</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>🛍️ Consumption</h2>
                
                <div class="form-group">
                    <label for="shopping">Monthly spending on goods (USD)</label>
                    <div class="slider-container">
                        <input type="range" id="shopping" class="slider" min="0" max="2000" value="400">
                        <div class="slider-value">$<span id="shopping-value">400</span>/month</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="waste">Trash bags per week</label>
                    <div class="slider-container">
                        <input type="range" id="waste" class="slider" min="0" max="10" value="2">
                        <div class="slider-value"><span id="waste-value">2</span> bags/week</div>
                    </div>
                </div>
            </div>

            <div class="navigation">
                <button class="button" onclick="calculateFootprint()">Calculate My Footprint</button>
                <button class="button button-secondary" onclick="showDashboard()">Back to Dashboard</button>
            </div>
        </div>

        <!-- Results -->
        <div id="results" class="card hidden">
            <div class="impact-score">
                <div class="score-number" id="total-score">0</div>
                <div class="score-label">kg CO₂ per month</div>
            </div>

            <div class="results-grid">
                <div class="result-card">
                    <div class="icon">🚗</div>
                    <div class="value" id="transport-value">0</div>
                    <div class="label">Transport</div>
                </div>
                <div class="result-card">
                    <div class="icon">🏠</div>
                    <div class="value" id="energy-value">0</div>
                    <div class="label">Energy</div>
                </div>
                <div class="result-card">
                    <div class="icon">🍽️</div>
                    <div class="value" id="food-value">0</div>
                    <div class="label">Food</div>
                </div>
                <div class="result-card">
                    <div class="icon">🛍️</div>
                    <div class="value" id="consumption-value">0</div>
                    <div class="label">Shopping</div>
                </div>
            </div>

            <div class="section">
                <h2>💡 Your Personalized Action Plan</h2>
                <div class="recommendations" id="recommendations">
                    <!-- Recommendations will be inserted here -->
                </div>
            </div>

            <div class="navigation">
                <button class="button button-secondary" onclick="showAssessment()">Retake Assessment</button>
                <button class="button" onclick="saveProgress()">Save Progress</button>
                <button class="button button-success" onclick="showShare()">Share Results</button>
                <button class="button button-secondary" onclick="showDashboard()">Dashboard</button>
            </div>
        </div>

        <!-- History -->
        <div id="history" class="card hidden">
            <div class="section">
                <h2>📊 Your Progress History</h2>
                
                <div id="history-list">
                    <p style="text-align: center; color: var(--text-muted);">No previous assessments found. Complete your first assessment to start tracking progress!</p>
                </div>
            </div>
            
            <div class="navigation">
                <button class="button" onclick="showAssessment()">New Assessment</button>
                <button class="button button-secondary" onclick="showDashboard()">Dashboard</button>
                <button class="button button-secondary" onclick="exportData()">Export Data</button>
            </div>
        </div>

        <!-- Share -->
        <div id="share" class="card hidden">
            <div class="share-card" id="share-card" style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; padding: 2rem; border-radius: 20px; text-align: center; margin-bottom: 2rem;">
                <h2>🌱 My Carbon Impact</h2>
                <div class="share-stats" id="share-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 1rem 0;">
                    <!-- Share stats will be populated here -->
                </div>
                <p id="share-message">Join me in reducing carbon emissions!</p>
            </div>
            
            <div class="navigation">
                <button class="button" onclick="shareToSocial('twitter')">Share on Twitter</button>
                <button class="button button-secondary" onclick="shareToSocial('facebook')">Share on Facebook</button>
                <button class="button button-success" onclick="copyShareLink()">Copy Link</button>
                <button class="button button-secondary" onclick="showDashboard()">Back</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Custom Modal -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">
                    <span id="modal-icon">ℹ️</span>
                    <span id="modal-title-text">Information</span>
                </div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-content" id="modal-content">
                <!-- Content will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentAssessment = null;
        
        // Achievement definitions
        const achievements = [
            { id: 'first_assessment', title: 'First Steps', icon: '🌱', description: 'Complete your first carbon assessment' },
            { id: 'week_streak', title: 'Weekly Warrior', icon: '🔥', description: 'Use the app for 7 days in a row' },
            { id: 'co2_saver', title: 'CO₂ Saver', icon: '💚', description: 'Reduce your footprint by 10%' },
            { id: 'green_champion', title: 'Green Champion', icon: '🏆', description: 'Complete 5 assessments' },
            { id: 'goal_achiever', title: 'Goal Achiever', icon: '🎯', description: 'Meet your monthly CO₂ goal' },
            { id: 'eco_warrior', title: 'Eco Warrior', icon: '⚔️', description: 'Reduce footprint by 50%' },
            { id: 'planet_saver', title: 'Planet Saver', icon: '🌍', description: 'Save 1000kg CO₂ total' },
            { id: 'consistency_king', title: 'Consistency King', icon: '👑', description: '30-day usage streak' }
        ];

        // Storage utilities
        function isStorageAvailable() {
            try {
                const test = '__storage_test__';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch (e) {
                return false;
            }
        }

        function getUserData() {
            if (!isStorageAvailable()) {
                return getDefaultUserData();
            }
            
            try {
                const dataStr = localStorage.getItem('carbonUserData');
                if (!dataStr) {
                    return getDefaultUserData();
                }
                const parsed = JSON.parse(dataStr);
                return parsed && typeof parsed === 'object' ? parsed : getDefaultUserData();
            } catch (e) {
                console.warn('Error parsing user data:', e);
                return getDefaultUserData();
            }
        }

        function getDefaultUserData() {
            return {
                assessments: [],
                achievements: [],
                streak: 0, // Start with 0 for new users
                totalSaved: 0,
                goal: null,
                lastVisit: null,
                hasSeenOnboarding: false,
                isFirstVisit: true // Track if this is first visit
            };
        }

        function saveUserData(userData) {
            if (!isStorageAvailable()) {
                console.warn('Storage not available');
                return false;
            }
            
            try {
                localStorage.setItem('carbonUserData', JSON.stringify(userData));
                return true;
            } catch (error) {
                console.error('Error saving user data:', error);
                return false;
            }
        }

        // Theme management
        function initializeTheme() {
            const savedTheme = isStorageAvailable() ? localStorage.getItem('theme') || 'light' : 'light';
            document.body.dataset.theme = savedTheme;
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const icon = document.querySelector('.theme-toggle');
            if (icon) {
                const isDark = document.body.dataset.theme === 'dark';
                icon.textContent = isDark ? '☀️' : '🌙';
            }
        }

        // Initialize sliders
        function initializeSliders() {
            const sliders = document.querySelectorAll('.slider');
            sliders.forEach(slider => {
                const valueDisplay = document.getElementById(slider.id + '-value');
                if (valueDisplay) {
                    valueDisplay.textContent = slider.value;
                }
                
                slider.addEventListener('input', function() {
                    const valueElement = document.getElementById(this.id + '-value');
                    if (valueElement) {
                        valueElement.textContent = this.value;
                    }
                });
            });
        }

        // Notification system
        function showNotification(message) {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Page navigation (internal functions)
        function hideAllSections() {
            ['dashboard', 'assessment-form', 'results', 'history', 'share'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.add('hidden');
                }
            });
        }

        function showResults() {
            hideAllSections();
            document.getElementById('results').classList.remove('hidden');
        }

        // Dashboard management (internal functions)
        function updateDashboard() {
            const userData = getUserData();
            
            document.getElementById('streak-count').textContent = userData.streak || 0;
            document.getElementById('total-saved').textContent = userData.totalSaved || 0;
            document.getElementById('achievement-count').textContent = (userData.achievements || []).length;
            
            if (userData.assessments && userData.assessments.length > 0) {
                const latest = userData.assessments[userData.assessments.length - 1];
                document.getElementById('current-footprint').textContent = latest.total || 0;
            } else {
                document.getElementById('current-footprint').textContent = 0;
            }
            
            updateGoalProgress(userData);
        }

        function updateGoalProgress(userData) {
            const goalProgress = document.getElementById('goal-progress');
            const goalText = document.getElementById('goal-text');
            const goalFill = document.getElementById('goal-progress-fill');
            
            if (userData.goal && userData.assessments.length > 0) {
                const latest = userData.assessments[userData.assessments.length - 1];
                const progress = Math.max(0, Math.min(100, (userData.goal - latest.total) / userData.goal * 100));
                
                goalProgress.classList.remove('hidden');
                goalFill.style.width = progress + '%';
                
                if (latest.total <= userData.goal) {
                    goalText.textContent = `🎉 Goal achieved! You're ${Math.round(userData.goal - latest.total)}kg under your target!`;
                    goalText.style.color = 'var(--success)';
                } else {
                    goalText.textContent = `${Math.round(latest.total - userData.goal)}kg over your goal. Keep going!`;
                    goalText.style.color = 'var(--warning)';
                }
            } else {
                goalProgress.classList.add('hidden');
            }
        }

        // Achievements - Optimized for faster loading
        function initializeAchievements() {
            const container = document.getElementById('achievements');
            if (!container) return;
            
            try {
                const userData = getUserData();
                const userAchievements = userData.achievements || [];
                
                // Build achievement HTML immediately - no delays
                const achievementHTML = achievements.map(achievement => {
                    const unlocked = userAchievements.includes(achievement.id);
                    return `
                        <div class="achievement ${unlocked ? 'unlocked' : ''}" 
                             onclick="showAchievementDetail('${achievement.id}')" 
                             title="${achievement.description}">
                            <div class="achievement-icon">${achievement.icon}</div>
                            <div class="achievement-title">${achievement.title}</div>
                        </div>
                    `;
                }).join('');
                
                // Set content immediately - no animation delays
                container.innerHTML = achievementHTML;
                
            } catch (error) {
                console.error('Error initializing achievements:', error);
                container.innerHTML = '<div class="achievement"><div class="achievement-icon">❌</div><div class="achievement-title">Error loading</div></div>';
            }
        }

        function checkAchievements() {
            const userData = getUserData();
            const newAchievements = [];
            
            if (userData.assessments.length >= 1 && !userData.achievements.includes('first_assessment')) {
                newAchievements.push('first_assessment');
            }
            
            if (userData.streak >= 7 && !userData.achievements.includes('week_streak')) {
                newAchievements.push('week_streak');
            }
            
            if (userData.assessments.length >= 5 && !userData.achievements.includes('green_champion')) {
                newAchievements.push('green_champion');
            }
            
            if (userData.streak >= 30 && !userData.achievements.includes('consistency_king')) {
                newAchievements.push('consistency_king');
            }
            
            if (userData.totalSaved >= 1000 && !userData.achievements.includes('planet_saver')) {
                newAchievements.push('planet_saver');
            }
            
            // Check CO2 reduction achievements
            if (userData.assessments.length >= 2) {
                const first = userData.assessments[0].total;
                const latest = userData.assessments[userData.assessments.length - 1].total;
                const reduction = ((first - latest) / first) * 100;
                
                if (reduction >= 10 && !userData.achievements.includes('co2_saver')) {
                    newAchievements.push('co2_saver');
                }
                
                if (reduction >= 50 && !userData.achievements.includes('eco_warrior')) {
                    newAchievements.push('eco_warrior');
                }
            }
            
            // Check goal achievement
            if (userData.goal && userData.assessments.length > 0) {
                const latest = userData.assessments[userData.assessments.length - 1];
                if (latest.total <= userData.goal && !userData.achievements.includes('goal_achiever')) {
                    newAchievements.push('goal_achiever');
                }
            }
            
            newAchievements.forEach(achievementId => {
                userData.achievements.push(achievementId);
                const achievement = achievements.find(a => a.id === achievementId);
                showNotification(`🏆 Achievement unlocked: ${achievement.title}!`);
            });
            
            if (newAchievements.length > 0) {
                saveUserData(userData);
                initializeAchievements();
                updateDashboard();
            }
        }

        // Fixed streak logic - only increment when user actually uses the app, start at 0 for new users
        function updateStreak(userData) {
            const today = new Date().toDateString();
            const lastVisit = userData.lastVisit;
            
            // For first-time users, don't increment streak yet
            if (userData.isFirstVisit) {
                userData.streak = 0;
                userData.isFirstVisit = false;
                userData.lastVisit = new Date().toISOString();
                return;
            }
            
            if (lastVisit) {
                const lastVisitDate = new Date(lastVisit).toDateString();
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayString = yesterday.toDateString();
                
                if (lastVisitDate === today) {
                    // Same day, maintain streak
                } else if (lastVisitDate === yesterdayString) {
                    // Consecutive day, increment streak
                    userData.streak++;
                } else {
                    // Broken streak, reset to 1 (today counts as day 1)
                    userData.streak = 1;
                }
            } else {
                // This should only happen for migrated users
                userData.streak = 1;
            }
            
            userData.lastVisit = new Date().toISOString();
        }

        function generateRecommendations(data) {
            const recommendations = [];
            
            // Basic recommendations based on highest emissions
            if (data.transport > 100) {
                recommendations.push({
                    title: 'Use public transport or bike for short trips',
                    difficulty: 'easy',
                    co2Impact: Math.round(data.transport * 0.2),
                    icon: '🚲'
                });
            }
            
            if (data.energy > 80) {
                recommendations.push({
                    title: 'Switch to LED bulbs and improve insulation',
                    difficulty: 'medium',
                    co2Impact: Math.round(data.energy * 0.15),
                    icon: '💡'
                });
            }
            
            if (data.food > 120) {
                recommendations.push({
                    title: 'Try meatless meals twice a week',
                    difficulty: 'easy',
                    co2Impact: Math.round(data.food * 0.25),
                    icon: '🥗'
                });
            }
            
            if (data.consumption > 50) {
                recommendations.push({
                    title: 'Buy second-hand and reduce waste',
                    difficulty: 'medium',
                    co2Impact: Math.round(data.consumption * 0.3),
                    icon: '♻️'
                });
            }

            const container = document.getElementById('recommendations');
            container.innerHTML = recommendations.length > 0 ? 
                recommendations.map(rec => `
                    <div class="recommendation-item">
                        <div class="recommendation-icon">${rec.icon}</div>
                        <div class="recommendation-content">
                            <div class="recommendation-title">${rec.title}</div>
                            <div class="recommendation-meta">
                                <div class="recommendation-impact">Save ${rec.co2Impact} kg CO₂/month</div>
                                <div class="recommendation-difficulty difficulty-${rec.difficulty}">${rec.difficulty.toUpperCase()}</div>
                            </div>
                        </div>
                    </div>
                `).join('') :
                '<div class="recommendation-item"><div class="recommendation-icon">🌱</div><div class="recommendation-content"><div class="recommendation-title">Great job! You\'re already doing well!</div><div class="recommendation-impact">Keep up the excellent work!</div></div></div>';
        }

        // Enhanced chart creation with graceful fallbacks
        function createEmissionsChart(data) {
            const ctx = document.getElementById('emissions-chart');
            if (!ctx) return;
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.log('Chart.js not available, showing text summary instead');
                ctx.parentElement.innerHTML = `
                    <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 15px;">
                        <h3 style="margin-bottom: 1rem; color: var(--text);">📊 Your Carbon Breakdown</h3>
                        ${data.map(d => `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.5rem 0; padding: 0.5rem; background: white; border-radius: 8px;">
                                <span style="color: var(--text);">${d.category}</span>
                                <span style="font-weight: bold; color: ${d.color};">${d.value} kg</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                return;
            }
            
            try {
                if (emissionsChart) {
                    emissionsChart.destroy();
                }

                emissionsChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: data.map(d => d.category),
                        datasets: [{
                            data: data.map(d => d.value),
                            backgroundColor: data.map(d => d.color),
                            borderWidth: 0,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
                console.log('Emissions chart created successfully');
            } catch (error) {
                console.error('Chart creation error:', error);
                // Fallback to text display
                ctx.parentElement.innerHTML = `
                    <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 15px;">
                        <h3 style="margin-bottom: 1rem; color: var(--text);">📊 Your Carbon Breakdown</h3>
                        ${data.map(d => `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.5rem 0; padding: 0.5rem; background: white; border-radius: 8px;">
                                <span style="color: var(--text);">${d.category}</span>
                                <span style="font-weight: bold; color: ${d.color};">${d.value} kg</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        function createHistoryChart(assessments) {
            if (!assessments || assessments.length < 2) return;

            const ctx = document.getElementById('history-chart');
            if (!ctx) return;
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.log('Chart.js not available for history chart, showing text summary');
                ctx.parentElement.innerHTML = `
                    <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 15px;">
                        <h3 style="margin-bottom: 1rem; color: var(--text);">📈 Progress Timeline</h3>
                        ${assessments.slice().reverse().map((assessment, index) => `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.5rem 0; padding: 0.5rem; background: white; border-radius: 8px;">
                                <span style="color: var(--text);">${new Date(assessment.date).toLocaleDateString()}</span>
                                <span style="font-weight: bold; color: var(--primary);">${assessment.total} kg CO₂</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                return;
            }
            
            try {
                if (historyChart) {
                    historyChart.destroy();
                }

                historyChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: assessments.map(a => new Date(a.date).toLocaleDateString()),
                        datasets: [{
                            label: 'Total CO₂ (kg/month)',
                            data: assessments.map(a => a.total),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'CO₂ Emissions (kg/month)'
                                }
                            }
                        }
                    }
                });
                console.log('History chart created successfully');
            } catch (error) {
                console.error('History chart creation error:', error);
                // Fallback to text display
                ctx.parentElement.innerHTML = `
                    <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 15px;">
                        <h3 style="margin-bottom: 1rem; color: var(--text);">📈 Progress Timeline</h3>
                        ${assessments.slice().reverse().map((assessment, index) => `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.5rem 0; padding: 0.5rem; background: white; border-radius: 8px;">
                                <span style="color: var(--text);">${new Date(assessment.date).toLocaleDateString()}</span>
                                <span style="font-weight: bold; color: var(--primary);">${assessment.total} kg CO₂</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        // Custom Modal Functions
        function showModal(title, content, icon = 'ℹ️') {
            const overlay = document.getElementById('modal-overlay');
            const titleIcon = document.getElementById('modal-icon');
            const titleText = document.getElementById('modal-title-text');
            const modalContent = document.getElementById('modal-content');
            
            titleIcon.textContent = icon;
            titleText.textContent = title;
            modalContent.innerHTML = content;
            
            overlay.classList.add('show');
            
            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
        }

        function closeModal(event) {
            // Only close if clicking overlay or close button, not modal content
            if (event && event.target.classList.contains('modal')) return;
            
            const overlay = document.getElementById('modal-overlay');
            overlay.classList.remove('show');
            
            // Restore body scroll
            document.body.style.overflow = '';
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        // Make functions globally available (for onclick handlers)
        window.closeModal = closeModal;

        window.showHelp = function() {
            const helpContent = `
                <div class="help-section">
                    <h3>🚀 How to Use Carbon Lite</h3>
                    <p><strong>1. Take an Assessment:</strong> Answer 9 quick questions about your lifestyle</p>
                    <p><strong>2. View Results:</strong> See your CO₂ footprint breakdown and personalized recommendations</p>
                    <p><strong>3. Save Progress:</strong> Track improvements over time and maintain your streak</p>
                    <p><strong>4. Set Goals:</strong> Create monthly CO₂ targets and monitor your progress</p>
                    <p><strong>5. Earn Achievements:</strong> Unlock badges as you reduce your environmental impact</p>
                </div>

                <div class="help-section">
                    <h3>🌟 Key Features</h3>
                    <ul>
                        <li><strong>Carbon Calculator:</strong> Comprehensive footprint analysis</li>
                        <li><strong>Smart Recommendations:</strong> Personalized tips to reduce emissions</li>
                        <li><strong>Progress Tracking:</strong> History of all your assessments</li>
                        <li><strong>Achievement System:</strong> 8 unlockable badges to motivate you</li>
                        <li><strong>Goal Setting:</strong> Set and track monthly CO₂ targets</li>
                        <li><strong>Data Export:</strong> Download your progress data</li>
                        <li><strong>Social Sharing:</strong> Inspire others with your progress</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>💡 Pro Tips</h3>
                    <ul>
                        <li>Complete assessments regularly to track trends</li>
                        <li>Follow the personalized recommendations</li>
                        <li>Set realistic monthly CO₂ goals (average is ~1,000kg)</li>
                        <li>Use the app daily to maintain your streak</li>
                        <li>Share your progress to inspire friends and family</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>🎯 Understanding Your Results</h3>
                    <p>Your carbon footprint is measured in kilograms of CO₂ equivalent per month. The global average is around 1,000kg per month. Our goal is to help you get below this number and continue reducing your impact over time.</p>
                </div>
            `;
            
            showModal('Carbon Lite Help Guide', helpContent, '🌱');
        };

        window.showAchievementDetail = function(achievementId) {
            const achievement = achievements.find(a => a.id === achievementId);
            if (!achievement) return;
            
            const userData = getUserData();
            const unlocked = userData.achievements.includes(achievementId);
            
            const achievementContent = `
                <div class="achievement-modal-content">
                    <div class="achievement-icon-large">${achievement.icon}</div>
                    <div class="achievement-description">${achievement.description}</div>
                    <div class="achievement-status ${unlocked ? 'unlocked' : 'locked'}">
                        ${unlocked ? 
                            '<strong>🎉 Achievement Unlocked!</strong><br>Congratulations on reaching this milestone!' : 
                            '<strong>🔒 Keep Going!</strong><br>Complete the requirements above to unlock this achievement.'
                        }
                    </div>
                </div>
            `;
            
            showModal(achievement.title, achievementContent, achievement.icon);
        };

        window.toggleTheme = function() {
            const currentTheme = document.body.dataset.theme;
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.dataset.theme = newTheme;
            if (isStorageAvailable()) {
                localStorage.setItem('theme', newTheme);
            }
            updateThemeIcon();
        };

        window.showDashboard = function() {
            hideAllSections();
            const dashboard = document.getElementById('dashboard');
            if (dashboard) {
                dashboard.classList.remove('hidden');
                updateDashboard();
                initializeAchievements(); // Ensure achievements are current
            }
        };

        window.showAssessment = function() {
            hideAllSections();
            document.getElementById('assessment-form').classList.remove('hidden');
        };

        window.showHistory = function() {
            const userData = getUserData();
            const container = document.getElementById('history-list');
            
            if (userData.assessments.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No previous assessments found. Complete your first assessment to start tracking progress!</p>';
            } else {
                const sortedHistory = userData.assessments.slice().reverse();
                const firstTotal = userData.assessments[0].total;
                
                container.innerHTML = sortedHistory.map((assessment, index) => {
                    const date = new Date(assessment.date).toLocaleDateString();
                    const improvement = index === sortedHistory.length - 1 ? 0 : 
                        Math.round(((firstTotal - assessment.total) / firstTotal) * 100);
                    
                    return `
                        <div class="history-item">
                            <div class="history-date">${date}</div>
                            <div class="history-total">${assessment.total} kg CO₂/month
                                ${improvement > 0 ? `<span class="badge">-${improvement}% improvement!</span>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                createHistoryChart(userData.assessments);
            }
            
            hideAllSections();
            document.getElementById('history').classList.remove('hidden');
        };

        window.showShare = function() {
            const userData = getUserData();
            
            if (userData.assessments.length === 0) {
                showNotification('Complete an assessment first to share your progress!');
                return;
            }

            const latest = userData.assessments[userData.assessments.length - 1];
            const improvement = userData.assessments.length > 1 ? 
                Math.round(((userData.assessments[0].total - latest.total) / userData.assessments[0].total) * 100) : 0;

            document.getElementById('share-stats').innerHTML = `
                <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; backdrop-filter: blur(10px);">
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.25rem;">${latest.total}</div>
                    <div>kg CO₂/month</div>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; backdrop-filter: blur(10px);">
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.25rem;">${userData.totalSaved}</div>
                    <div>kg CO₂ saved</div>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; backdrop-filter: blur(10px);">
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.25rem;">${userData.streak}</div>
                    <div>day streak</div>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; backdrop-filter: blur(10px);">
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.25rem;">${improvement}%</div>
                    <div>improvement</div>
                </div>
            `;

            const message = improvement > 0 ? 
                `I've reduced my carbon footprint by ${improvement}% using Carbon Lite! 🌱` :
                `I'm tracking my carbon footprint with Carbon Lite! Join me in fighting climate change! 🌱`;
            
            document.getElementById('share-message').textContent = message;

            hideAllSections();
            document.getElementById('share').classList.remove('hidden');
        };

        window.calculateFootprint = function() {
            try {
                const carKm = parseFloat(document.getElementById('car-km').value) || 0;
                const flights = parseFloat(document.getElementById('flights').value) || 0;
                const publicTransport = parseFloat(document.getElementById('public-transport').value) || 0;
                const electricity = parseFloat(document.getElementById('electricity').value) || 0;
                const heating = parseFloat(document.getElementById('heating').value) || 0;
                const meatMeals = parseFloat(document.getElementById('meat-meals').value) || 0;
                const dairy = parseFloat(document.getElementById('dairy').value) || 0;
                const shopping = parseFloat(document.getElementById('shopping').value) || 0;
                const waste = parseFloat(document.getElementById('waste').value) || 0;

                // Calculate carbon footprint (simplified calculation in kg CO2 per month)
                const transport = (carKm * 4.33 * 0.21) + (flights * 500 / 12) + (publicTransport * 4.33 * 0.05);
                const energy = (electricity * 0.5) + (heating * 2.3);
                const food = (meatMeals * 4.33 * 3.3) + (dairy * 30 * 1.9);
                const consumption = (shopping * 0.5) + (waste * 4.33 * 10);

                const total = Math.round(transport + energy + food + consumption);

                // Update display
                document.getElementById('total-score').textContent = total;
                document.getElementById('transport-value').textContent = Math.round(transport) + ' kg';
                document.getElementById('energy-value').textContent = Math.round(energy) + ' kg';
                document.getElementById('food-value').textContent = Math.round(food) + ' kg';
                document.getElementById('consumption-value').textContent = Math.round(consumption) + ' kg';

                // Generate recommendations
                generateRecommendations({
                    transport, energy, food, consumption, total,
                    carKm, flights, publicTransport, electricity, heating, meatMeals, dairy, shopping, waste
                });

                // Store current assessment
                currentAssessment = {
                    date: new Date().toISOString(),
                    total: total,
                    transport: Math.round(transport),
                    energy: Math.round(energy),
                    food: Math.round(food),
                    consumption: Math.round(consumption),
                    inputs: { carKm, flights, publicTransport, electricity, heating, meatMeals, dairy, shopping, waste }
                };

                // Show results
                showResults();

            } catch (error) {
                console.error('Calculation error:', error);
                showNotification('Unable to calculate footprint. Please check your inputs and try again.');
            }
        };

        window.setGoal = function() {
            const goalInput = document.getElementById('carbon-goal');
            const goal = parseFloat(goalInput.value);
            
            if (goal && goal > 0) {
                const userData = getUserData();
                userData.goal = goal;
                saveUserData(userData);
                updateGoalProgress(userData);
                showNotification('Goal set successfully! 🎯');
            } else {
                showNotification('Please enter a valid goal amount.');
            }
        };

        window.saveProgress = function() {
            if (!currentAssessment) {
                showNotification('Please complete an assessment first!');
                return;
            }

            const userData = getUserData();
            userData.assessments.push(currentAssessment);
            
            // Keep only last 24 assessments
            if (userData.assessments.length > 24) {
                userData.assessments = userData.assessments.slice(-24);
            }
            
            // Update streak (only when user actively saves progress)
            updateStreak(userData);
            
            // Update total saved
            if (userData.assessments.length > 1) {
                const first = userData.assessments[0].total;
                const latest = userData.assessments[userData.assessments.length - 1].total;
                userData.totalSaved = Math.max(0, Math.round((first - latest) * userData.assessments.length));
            }
            
            saveUserData(userData);
            updateDashboard();
            checkAchievements();
            
            showNotification('Progress saved! Keep up the great work 🌱');
        };

        window.shareToSocial = function(platform) {
            const message = document.getElementById('share-message').textContent;
            const url = window.location.href;
            
            let shareUrl;
            if (platform === 'twitter') {
                shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}&url=${encodeURIComponent(url)}`;
            } else if (platform === 'facebook') {
                shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(message)}`;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
        };

        window.copyShareLink = function() {
            const message = document.getElementById('share-message').textContent;
            const url = window.location.href;
            const shareText = `${message}\n\nTrack your carbon footprint: ${url}`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('Share link copied to clipboard! 📋');
                }).catch(() => {
                    showNotification('Unable to copy link. Please try again.');
                });
            } else {
                showNotification('Clipboard not available. Please copy manually.');
            }
        };

        window.exportData = function() {
            try {
                const userData = getUserData();
                const exportData = {
                    ...userData,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `carbon-lite-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
                
                showNotification('Data exported successfully! 📊');
            } catch (error) {
                showNotification('Unable to export data. Please try again.');
            }
        };

        // Simplified app initialization - faster loading
        function initializeApp() {
            try {
                // Fast initialization sequence
                initializeTheme();
                initializeSliders();
                
                // Load user data and update only if needed
                const userData = getUserData();
                
                // Only update streak on first app load, not when just viewing dashboard
                if (userData.isFirstVisit || !userData.lastVisit || 
                    new Date(userData.lastVisit).toDateString() !== new Date().toDateString()) {
                    updateStreak(userData);
                    saveUserData(userData);
                }
                
                updateDashboard();
                initializeAchievements(); // Fast loading now
                showDashboard();
                
                // Show welcome message for new users (after everything loads)
                if (!userData.hasSeenOnboarding) {
                    setTimeout(() => {
                        showNotification('Welcome to Carbon Lite! 🌱 Take your first assessment to get started.');
                        userData.hasSeenOnboarding = true;
                        saveUserData(userData);
                    }, 1000);
                }
            } catch (error) {
                console.error('App initialization error:', error);
                // Fallback UI
                document.body.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; text-align: center; padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-family: 'Segoe UI', sans-serif;">
                        <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">🌱 Carbon Lite</h1>
                        <p style="font-size: 1.2rem; margin-bottom: 2rem;">Unable to load the application properly</p>
                        <button onclick="window.location.reload()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 1rem 2rem; border-radius: 25px; font-size: 1rem; cursor: pointer;">Refresh Page</button>
                    </div>
                `;
            }
        }

        // Start the app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
    </script>
</body>
</html>